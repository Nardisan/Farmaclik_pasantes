<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <template id="report_shooping_book"  inherit_id="l10n_ve_accountant.report_shooping_book">
        <xpath expr="." position="replace">
            <t t-call="web.html_container">
                <t t-set="data_report_margin_top" t-value="12"/>
                <t t-set="data_report_header_spacing" t-value="9"/>
                <t t-set="data_report_dpi" t-value="110"/>
                <t t-call="web.basic_layout">
                    <style type="text/css">
                            .borde{
                                border: solid 1px gray;
                                border-radius: 20px;
                                padding:5px;
                            }
    
                            table.tableizer-table{
                            /*font-size:10px;*/
                            font-family: Arial, Helvetica, sans-serif;
                            }
                            .tableizer-table td{
                            /* border: 1px solid #000;*/
                            /*font-size:10px;*/
                            text-align: center;
                            }
                            .tableizer-table th {
                            font-weight: bold;
                            text-align: center;
                            /* border: 1px solid #000;*/
                            /*font-size:10px;*/
                            /*background-color:#BFBFBF;*/
                            }
    
                            .tableizer-tableT td{
                            border: 1px solid #000;
                            /*font-size:10px;*/
                            text-align: center;
                            }
                            .tableizer-tableT th {
                            font-weight: bold;
                            text-align: center;
                            border: 1px solid #000;
                            /*font-size:10px;*/
                            /*background-color:#BFBFBF;*/
                            }
    
                            tr.total td {
                            background: transparent;
                            border-style: none ;
                            }
                            table {text-align:center}
                            .table-bordered {
                            empty-cells: hide;
                            }
                            .table-bordered tr td:nth-child(1){
                            text-align:left;
                            }
    
                            .logo_company{
                                position:absolute;
                                margin-top:15px;
                                margin-left:10px;
                            }
                        </style>

                        <table class="tableizer-table">
                            <thead>
                                <tr>
                                    <td class="text-center" colspan="22">
                                      <div style="border:1px solid black;border-radius:20px;">
                                        <table style="width:100%;">
                                            <tr>
                                                <td style="width:33%;" colspan="3" class="text-left" valign="middle">
                                                    <img t-if="company_id.logo" t-att-src="image_data_uri(company_id.logo)" height="60px" style="max-width: 150px;padding-left:5px; margin-top:20px;"/>
                                                </td>
                                                <td style="width:34%;" class="text-center" colspan="15">
                                                    <table style="width:100%;font-size:14px;margin-top:0px;">
                                                        <tr style="margin-top:0px;">
                                                            <th class="text-center"><span t-esc="company_id.name"/></th>
                                                        </tr>
                                                        <tr>
                                                            <th class="text-center"><span t-esc="company_vat"/></th>
                                                        </tr>
                                                        <tr>
                                                            <th class="text-center"><span>** COMPRAS **</span></th>
                                                        </tr>
                                                        <tr>
                                                            <th class="text-center"><span>LIBRO DE COMPRAS</span></th>
                                                        </tr>
                                                        <tr>
                                                            <th class="text-center"><span>Sucursales: </span><span t-esc="branch"/></th>
                                                        </tr>
                                                        <tr>
                                                            <th class="text-center">
                                                                DEL: <span t-esc="data['date_from']" t-options="{&quot;widget&quot;: &quot;date&quot;}"/>
                                                                AL: <span t-esc="data['date_to']" t-options="{&quot;widget&quot;: &quot;date&quot;}"/>
                                                            </th>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style="width:33%;" colspan="4" class="text-right">
                                                    <ul class="list-unstyled" style="padding:5px">
                                                        <li>Fecha:<span t-esc="datetime.datetime.now().strftime('%d/%m/%Y')"/></li>
                                                        <li>Hora:<span t-esc="hora_printer"/></li>
                                                    </ul>
                                                </td>
                                            </tr>
                                        </table>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="22">
                                        <br/>
                                    </td>
                                </tr>
                                <tr>
                                    <th colspan="12"/>
                                    <th colspan="10" style="text-align:center; font-size:10px">COMPRAS INTERNAS O IMPORTACIONES</th>
                                </tr>
                            </thead>
                        </table>
                        
                    <div class="page" style="font-size:12px;font-family: Times;line-height: 1.6;">
                        
                        <br/>
                        <t t-set="R30" t-value="0"/>
                        <t t-set="R31" t-value="0"/>
                        <t t-set="R32" t-value="0"/>
                        <t t-set="R312" t-value="0"/>
                        <t t-set="R313" t-value="0"/>
                        <t t-set="R322" t-value="0"/>
                        <t t-set="R323" t-value="0"/>
                        <t t-set="R332" t-value="0"/>
                        <t t-set="R342" t-value="0"/>
                        <t t-set="R333" t-value="0"/>
                        <t t-set="R343" t-value="0"/>
                        <t t-set="R33" t-value="0"/>
                        <t t-set="R34" t-value="0"/>
                        <t t-set="R35" t-value="0"/>
                        <t t-set="R36" t-value="0"/>
                        <t t-set="untaxed" t-value="0"/>
                        <t t-set="acum_exento" t-value="0"/>
                        <t t-set="untaxed_deductible" t-value="0"/>
                        <t t-set="untaxed_not_deductible" t-value="0"/>
                        <t t-set="tax" t-value="0"/>
                        <t t-set="tax_deductible" t-value="0"/>
                        <t t-set="tax_not_deductible" t-value="0"/>
                        <t t-set="retencion" t-value="0"/>
                        <t t-set="retention" t-value="0"/>
                        <t t-set="retencion_three" t-value="0"/>
                        <t t-set="total" t-value="0"/>
                        <t t-set="iva_percibido" t-value="0"/>
                        <t t-set="iva_percibido_g" t-value="0"/>
                        <t t-set="retencion_g" t-value="0"/>
                        <t t-set="retencion_ga" t-value="0"/>
                        <t t-set="iva_percibido_ga" t-value="0"/>
                        <t t-set="retencion_r" t-value="0"/>
                        <t t-set="iva_percibido_r" t-value="0"/>
                        <t t-set="monto_impuesto_untaxed_exento" t-value="0"/>
                        <t t-set="prorratas" t-value="0"/>
                        <t t-set="porc_prorrata" t-value="0"/>
                        <t t-set="acumret" t-value="0"/>
                        <!-- <t t-set="total_expe" t-value="0"/> -->
                        <table class="tableizer-table">
                            <thead>
                                <tr class="borde" style="font-size:10px;">
                                    <th>Oper. Nro</th>                      <!-- 1 -->
                                    <th>Fecha de la Factura</th>            <!-- 2 -->
                                    <th width="5%">RIF. No.</th>            <!-- 3 -->
                                    <th>Nombre o Razón Social</th>          <!-- 4 -->
                                    <!-- <th>Serie</th>                          5 -->
                                    <th>Tipo de Prov.</th>                  <!-- 6 -->
                                    <th>Número de Factura.</th>             <!-- 7 -->
                                    <th>Núm. Ctrol.</th>                    <!-- 8 -->
                                    <th>Núm. de Expedte. Import</th>         <!-- 10 -->
                                    <th>Núm. Planilla de Import</th>         <!-- 9 -->
                                    <th>Número Nota Debito</th>             <!-- 11 -->
                                    <th>Número Nota Credito.</th>           <!-- 12 -->
                                    <th>Número Factura Afectada</th>        <!-- 13 -->
                                    <th class="text-right">Total Compras Incluyendo IVA</th>   <!-- 14 -->
                                    <th class="text-right">Compras Exentas</th>                <!-- 15 -->
                                    <th>Compras Exoneradas</th>             <!-- exoneradas -->
                                    <th>Compras No sujetas</th>             <!-- no sujetas -->
                                    <th>Base Imponible</th>                 <!-- 18 -->
                                    <th>% Alícuota</th>                     <!-- 19 -->
                                    <th class="text-right">Impuesto IVA Deducible</th>         <!-- 20 -->
                                    <th>Base Imponible No Deducible</th>    <!-- 21 -->
                                    <th>% Alícuota</th>                     <!-- 22 -->
                                    <th>IVA NO deducible</th>               <!-- 22 -->
                                    <th>IVA Retenido<br/>(al vendedor)</th>     <!-- 24 -->
                                    <!-- <th width="3%">% Ret.</th> -->  <!-- 25 -->
                                    <th>Número de Comprobante</th>          <!-- 26 -->
                                    <th>Fecha de Comprobante</th>          <!-- 27 -->
                                </tr>
                            </thead>
                            <t t-if="con_documento">
                                <t t-if="not in_bs">
                                    <tbody>
                                        <tr style="font-size:10px;">
                                            <t t-set="count" t-value="0"/>
                                            <t t-set="fac" t-value="fact.filtered(lambda doc: doc.transaction_type != '04-ajuste')"/>
                                            <t t-foreach="fac.sorted(lambda m: m.invoice_date)" t-as="u">
                                                <t t-set="count" t-value="count+1"/>
                                                <t t-if="u.state !='annulled'">
                                                    <tr>
                                                        <t t-if="u.doc_impor_export">
    
                                                            <!-- EMPIEZAN LOS CALCULOS -->
                                                            <t t-set="total" t-if="u.move_type == 'in_invoice'" t-value="total + sum(u.mapped('amount_total'))"/>
                                                            <t t-set="total" t-if="u.move_type == 'in_refund'" t-value="total - sum(u.mapped('amount_total'))"/>
                                                            
                                                            <!-- Calculamos el Exento -->
                                                            <t t-set="exento" t-value="sum(u.invoice_line_ids.filtered(lambda line: not len(line.tax_ids)).mapped('price_subtotal')) + sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.amount == 0))).mapped('price_subtotal'))"/>
                                                            
                                                            <!-- Calculamos los impuestos REDUCIDOS -->
                                                            <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))))">
                                                                <!-- Base imponible del Impuesto -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="R313" t-value="R313 +sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="R313" t-value="R313 -sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))"/>
                                                                <!-- Monto del Impuesto -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="R323" t-value="R323 + (sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="R323" t-value="R323 - (sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))"/>
                                                                <!-- Iva Percibido  -->
                                                                <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                <t t-if="u.wh_id">
                                                                    <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="retencion_r" t-value="retencion_r-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention)"/>
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="retencion_r" t-value="retencion_r+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention)"/>
                                                                    <!-- Iva Percibido  -->
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_r" t-value="iva_percibido_r-(sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention))"/>
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_r" t-value="iva_percibido_r+(sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention))"/>
                                                                </t>
                                                            </t>
                                                            <!-- Calculamos los impuestos ADICIONAL -->
                                                            <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))))">
                                                                <!-- Base imponible del Impuesto -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="R312" t-value="R312 +sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="R312" t-value="R312 -sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))"/>
                                                                <!-- Monto del Impuesto -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="R322" t-value="R322 + (sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="R322" t-value="R322 - (sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))"/>
                                                                <!-- Iva Percibido  -->
                                                                <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                <t t-if="u.wh_id">
                                                                    <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="retencion_ga" t-value="retencion_ga-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention)"/>
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="retencion_ga" t-value="retencion_ga+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention)"/>
                                                                    <!-- Iva Percibido  -->
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_ga" t-value="iva_percibido_ga-(sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention))"/>
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_ga" t-value="iva_percibido_ga+(sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention))"/>
                                                                </t>
                                                            </t>
                                                            <!-- Calculamos los impuestos GENERAL -->
                                                            <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))))">
                                                                <!-- Base imponible del Impuesto -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="R31" t-value="R31 +sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="R31" t-value="R31 -sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))"/>
                                                                <!-- Monto del Impuesto -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="R32" t-value="R32 + (sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="R32" t-value="R32 - (sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))"/>
                                                                <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                <t t-if="u.wh_id">
                                                                    <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="retencion_g" t-value="retencion_g-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention)"/>
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="retencion_g" t-value="retencion_g+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention)"/>
                                                                    <!-- Iva Percibido  -->
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_g" t-value="iva_percibido_g-(sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention))"/>
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_g" t-value="iva_percibido_g+(sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention))"/>
                                                                </t>
                                                            </t>
                                                            <!-- Calculamos el TOTAL de impuestos EXENTOS -->
                                                            <t t-set="untaxed" t-if="u.move_type == 'in_invoice'" t-value="untaxed + exento"/>
                                                            <t t-set="untaxed" t-if="u.move_type == 'in_refund'" t-value="untaxed - exento"/>
                                                            <t t-set="R30" t-if="u.move_type == 'in_invoice'" t-value="R30 + exento"/>
                                                            <t t-set="R30" t-if="u.move_type == 'in_refund'" t-value="R30 - exento"/>
                                                            
                                                            <!-- Retenciones -->
                                                            <t t-if="u.move_type == 'in_invoice'" t-set="retencion" t-value="retencion + (u.wh_id.total_tax_ret / u.manual_currency_exchange_rate)"/>
                                                            <t t-if="u.move_type == 'in_refund'" t-set="retencion" t-value="retencion - (u.wh_id.total_tax_ret / u.manual_currency_exchange_rate)"/>
                                                            <!-- TOTAL de IMPUESTOS (Reducido + General + Adicional)-->
                                                            <t t-set="tax" t-if="u.move_type == 'in_invoice'" t-value="tax + u.amount_tax"/>
                                                            <t t-set="tax" t-if="u.move_type == 'in_refund'" t-value="tax - u.amount_tax"/>
                                                            <!-- IVA PERCIBIDO -->
                                                            <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido" t-value="iva_percibido+((u.amount_tax)-(u.wh_id.total_tax_ret))"/>
                                                            <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido" t-value="iva_percibido-((u.amount_tax)-(u.wh_id.total_tax_ret))"/>
                                                            <!-- TERMINAN LOS CALCULOS -->
                
                                                        </t>
                                                        
                                                        <t t-else="">
    
                                                            <!-- EMPIEZAN LOS CALCULOS -->
                                                            <t t-set="total" t-if="u.move_type == 'in_invoice'" t-value="total + sum(u.mapped('amount_total'))"/>
                                                            <t t-set="total" t-if="u.move_type == 'in_refund'" t-value="total - sum(u.mapped('amount_total'))"/>
                                                            
                                                            <!-- Calculamos el Exento -->
                                                            <t t-set="exento" t-value="sum(u.invoice_line_ids.filtered(lambda line: not len(line.tax_ids)).mapped('price_subtotal')) + sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.amount == 0))).mapped('price_subtotal'))"/>
                                                            <!-- Calculamos los impuestos REDUCIDOS -->
                                                            <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))))">
                                                                <!-- Base imponible del Impuesto -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="R333" t-value="R333 +sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="R333" t-value="R333 -sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))"/>
                                                                <!-- Monto del Impuesto -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="R343" t-value="R343 + (sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="R343" t-value="R343 - (sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))"/>
                                                                <!-- Iva Percibido  -->
                                                                <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                <t t-if="u.wh_id">
                                                                    <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="retencion_r" t-value="retencion_r-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention)"/>
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="retencion_r" t-value="retencion_r+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention)"/>
                                                                    <!-- Iva Percibido  -->
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_r" t-value="iva_percibido_r-(sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention))"/>
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_r" t-value="iva_percibido_r+(sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention))"/>
                                                                </t>
                                                            </t>
                                                            <!-- Calculamos los impuestos ADICIONAL -->
                                                            <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))))">
                                                                <!-- Base imponible del Impuesto -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="R332" t-value="R332 +sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="R332" t-value="R332 -sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))"/>
                                                                <!-- Monto del Impuesto -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="R342" t-value="R342 + (sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="R342" t-value="R342 - (sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))"/>
                                                                <!-- Iva Percibido  -->
                                                                <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                <t t-if="u.wh_id">
                                                                    <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="retencion_ga" t-value="retencion_ga-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention)"/>
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="retencion_ga" t-value="retencion_ga+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention)"/>
                                                                    <!-- Iva Percibido  -->
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_ga" t-value="iva_percibido_ga-(sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention))"/>
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_ga" t-value="iva_percibido_ga+(sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention))"/>
                                                                </t>
                                                            </t>
                                                            <!-- Calculamos los impuestos GENERAL -->
                                                            <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))))">
                                                                <!-- Base imponible del Impuesto -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="R33" t-value="R33 +sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="R33" t-value="R33 -sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))"/>
                                                                <!-- Monto del Impuesto -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="R34" t-value="R34 + (sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="R34" t-value="R34 - (sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))"/>
                                                                <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                <t t-if="u.wh_id">
                                                                    <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="retencion_g" t-value="retencion_g-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention)"/>
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="retencion_g" t-value="retencion_g+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention)"/>
                                                                    <!-- Iva Percibido  -->
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_g" t-value="iva_percibido_g-(sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention))"/>
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_g" t-value="iva_percibido_g+(sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention))"/>
                                                                </t>
                                                            </t>
                                                            <!-- Calculamos el TOTAL de impuestos EXENTOS -->
                                                            <t t-set="untaxed" t-if="u.move_type == 'in_invoice'" t-value="untaxed + exento"/>
                                                            <t t-set="untaxed" t-if="u.move_type == 'in_refund'" t-value="untaxed - exento"/>
                                                            
                                                            
                                                            <t t-set="R30" t-if="u.move_type == 'in_invoice'" t-value="R30 + exento"/>
                                                            <t t-set="R30" t-if="u.move_type == 'in_refund'" t-value="R30 - exento"/>
                                                            
                                                            
                                                            <!-- Retenciones -->
                                                            <t t-if="u.move_type == 'in_invoice'" t-set="retencion" t-value="retencion + (u.wh_id.total_tax_ret / u.manual_currency_exchange_rate)"/>
                                                            <t t-if="u.move_type == 'in_refund'" t-set="retencion" t-value="retencion - (u.wh_id.total_tax_ret / u.manual_currency_exchange_rate)"/>
                                                            <!-- TOTAL de IMPUESTOS (Reducido + General + Adicional)-->
                                                            <t t-set="tax" t-if="u.move_type == 'in_invoice'" t-value="tax + u.amount_tax"/>
                                                            <t t-set="tax" t-if="u.move_type == 'in_refund'" t-value="tax - u.amount_tax"/>
                                                            <!-- IVA PERCIBIDO -->
                                                            <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido" t-value="iva_percibido+((u.amount_tax)-(u.wh_id.total_tax_ret))"/>
                                                            <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido" t-value="iva_percibido-((u.amount_tax)-(u.wh_id.total_tax_ret))"/>
                                                            <!-- TERMINAN LOS CALCULOS -->
                                                        </t>
                                                               
                                                       
    
                                                        <td><t t-esc="count"/></td> <!-- N° Operación -->
                                                        <td><span t-esc="u.invoice_date" t-options="{&quot;widget&quot;: &quot;date&quot;}"/></td> <!-- Fecha de la Factura -->
                                                        <td width="5%"><span t-esc="u.partner_id.rif"/></td>  <!-- RIF -->
                                                        <td class="text-left"><span t-esc="u.partner_id.name"/></td> <!-- Nombre o Razón social -->
                                                        <!--<td>-</td> Serie  -->
                                                        <td><span t-esc="u.partner_id.residence_type"/></td> <!-- Tipo de Proveedor -->
                                                        <td><span t-esc="u.vendor_invoice_number if u.move_type == 'in_invoice' and not u.debit_origin_id else '-'"/></td> <!-- Número de Factura -->
    
                                                        <td><span t-esc="u.nro_control"/></td> <!-- Número de Control de Factura -->
                                                        <td><span t-esc="u.num_export"/></td>  <!-- Número de Planilla de Importación -->
                                                        <td><span t-esc="u.num_import"/></td>  <!-- Número de Expediente Importación -->
                                                        <td><span t-esc="u.vendor_invoice_number if u.move_type == 'in_invoice' and u.debit_origin_id else '-'"/></td> <!-- Número Nota de Débito-->
    
                                                        <td><span t-esc="u.vendor_invoice_number if u.move_type == 'in_refund' else '-'"/></td><!-- Número Nota de Crédito -->
    
                                                        <t t-if="u.move_type == 'in_refund'">
                                                            <td><span t-esc="u.reversed_entry_id.vendor_invoice_number"/></td>
                                                        </t>
                                                        <t t-elif="u.move_type == 'in_invoice' and u.debit_origin_id">
                                                            <td><span t-esc="u.debit_origin_id.vendor_invoice_number"/></td>
                                                        </t>
                                                        <t t-else="">
                                                            <td><span>-</span></td>
                                                        </t>
                                                        
                                                        <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span t-esc="sum(u.mapped('amount_total'))" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td> 
                                                        <!-- Total Compras Incluyendo el IVA -->
                                                        <t t-set="monto_impuesto" t-value="sum(u.invoice_line_ids.mapped('tax_ids.amount'))"/>
                                                        <t t-set="monto_impuesto_untaxed" t-value="sum(u.invoice_line_ids.filtered(lambda whl: not whl.tax_ids).mapped('price_subtotal')) + sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.amount == 0))).mapped('price_subtotal'))"/>
                                                        <t t-set="monto_impuesto_untaxed_exento" t-value="sum(u.invoice_line_ids.filtered(lambda whl: len(whl.tax_ids) == 0).mapped('price_subtotal'))"/>
                                                        <t t-if="exento &gt; 0">
                                                            <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t>
                                                                <span t-esc="exento" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/>
                                                                <t t-set="acum_exento" t-value="acum_exento + (exento)"/>
                                                            </td> 
                                                        </t>
                                                        <t t-else="">
                                                            <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span>0.0</span></td> 
                                                        </t>
                                                        
                                                        <td>-</td><!-- exoneradas -->
                                                        <td>-</td><!-- no sujetas -->
                                                        <!-- IVA NO DEDUCIBLE -->
                                                        <t t-if="not u.deductible">
                                                            <t t-set="tax_deductible" t-if="u.move_type == 'in_invoice'" t-value="tax_deductible + u.amount_tax"/>
                                                            <t t-set="tax_deductible" t-if="u.move_type == 'in_refund'" t-value="tax_deductible - u.amount_tax"/>
                                                            <t t-set="untaxed_deductible" t-if="u.move_type == 'in_invoice'" t-value="untaxed_deductible + sum(u.invoice_line_ids.filtered(lambda whl: whl.tax_ids).mapped('price_subtotal'))"/>
                                                            <t t-set="untaxed_deductible" t-if="u.move_type == 'in_refund'" t-value="untaxed_deductible - sum(u.invoice_line_ids.filtered(lambda whl: whl.tax_ids).mapped('price_subtotal'))"/>
                                                            <t t-if="sum(u.invoice_line_ids.mapped('tax_ids.amount')) &gt; 0">
                                                            <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span t-esc="sum(u.mapped('amount_total')) - (exento + u.amount_tax)" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                                            </t>
                                                            <t t-else="">
                                                                <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span>0.0</span></td>
                                                            </t>
                                                            <td><span t-esc="sum(u.invoice_line_ids.mapped('tax_ids.amount'))"/>%</td><!-- Porcentaje Alicuota -->
                                                            <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span t-esc="u.amount_tax" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                                            <td>-</td>
                                                            <td>-</td>
                                                            <td>-</td>
                                                        <!-- Monto Impuesto -->
                                                        </t>
                                                        <!-- IVA NO DEDUCIBLE -->
    
                                                        <!-- IVA  Retenido al VENDEDOR -->
    
                                                        <!-- Compras Exentas -->
                                                        <t t-if="u.deductible">
                                                            <t t-set="tax_not_deductible" t-if="u.move_type == 'in_invoice'" t-value="tax_not_deductible + u.amount_tax"/>
                                                            <t t-set="tax_not_deductible" t-if="u.move_type == 'in_refund'" t-value="tax_not_deductible - u.amount_tax"/>
                                                            <t t-set="untaxed_not_deductible" t-if="u.move_type == 'in_invoice'" t-value="untaxed_not_deductible + sum(u.invoice_line_ids.filtered(lambda whl: whl.tax_ids).mapped('price_subtotal'))"/>
                                                            <t t-set="untaxed_not_deductible" t-if="u.move_type == 'in_refund'" t-value="untaxed_not_deductible - sum(u.invoice_line_ids.filtered(lambda whl: whl.tax_ids).mapped('price_subtotal'))"/>
                                                            <td>-</td>
                                                            <td>-</td>
                                                            <td>-</td>
                                                            <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span t-esc="sum(u.invoice_line_ids.filtered(lambda whl: whl.tax_ids).mapped('price_subtotal'))" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
    
                                                            <td><span t-esc="sum(u.invoice_line_ids.mapped('tax_ids.amount'))"/>%</td><!-- Porcentaje Alicuota -->
    
                                                            <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span t-esc="u.amount_tax" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                                        </t>
                                                        <!-- Monto Impuesto -->
                                                        <td>
                                                            <t t-if="u.move_type == 'in_refund'">
                                                                <span t-esc="u.wh_id.total_tax_ret" t-options="{'widget': 'monetary', 'display_currency': u.currency_id, 'from_currency': u.currency_id}"/>
                                                            </t>                                                
                                                        </td>
                                                        <!-- IVA  Retenido al VENDEDOR -->
    
                                                        <td>
                                                            <t t-if="u.wh_id">
                                                                <span t-esc="u.wh_id.number"/>
                                                            </t>
                                                        </td><!-- Numero comprobante retencion -->

                                                        <td>
                                                            <t t-if="u.wh_id">
                                                                <span t-esc="u.wh_id.date.strftime('%d/%m/%Y')"/>
                                                            </t>
                                                        </td><!-- Fecha comprobante retencion -->
                                                    
                                                    </tr>
                                                </t>
                                            </t>
                                        </tr>
                                        <tr class="total" style="font-size:10px;">
                                            <td colspan="12" class="text-right">TOTAL</td> 
                                            <th class="text-right"><span t-esc="total" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th>
                                            <th class="text-right"><span t-esc="acum_exento" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th>
                                            <th/>
                                            <th/>
                                            
                                            <!-- DEDUCIBLE INICIO -->
                                            <th class="text-right"><span t-esc="R33 + R31 + R312 + R313 + R332 + R333" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th><!--BASE IMPONIBLE -->
                                            <td/>
                                            <th class="text-right"><span t-esc="tax_deductible" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th>
                                            <!-- DEDUCIBLE FIN -->
                                            <t t-set="R30" t-value="acum_exento"/>
                                            <!-- NO DEDUCIBLE INICIO -->
                                            <th class="text-right"><span t-esc="untaxed_not_deductible" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th>
                                            <td/>
                                            <th class="text-right"><span t-esc="tax_not_deductible" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th>
                                            <!-- MO DEDUCIBLE FIN -->
    
                                            <!-- <t t-set="R34" t-value="tax"/> -->
                                            <!-- <th><span t-esc="acumret" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th> -->
                                            <th class="text-center"><span t-esc="retencion" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th>
                                            <th>-</th>
                                        </tr>
                                    </tbody>
                                </t>
                                <!-- Bolivar -->
                                <t t-else="">
                                    <tbody>
                                        <tr style="font-size:10px;">
                                            <t t-set="count" t-value="0"/>
                                            <t t-set="fac" t-value="fact.filtered(lambda doc: doc.transaction_type != '04-ajuste')"/>
                                            <t t-foreach="fac.sorted(lambda m: m.invoice_date)" t-as="u">
                                                <t t-set="count" t-value="count+1"/>
                                                <t t-if="u.state !='annulled'">
                                                    <tr>
                                                        <!-- EMPIEZAN LOS CALCULOS -->
                                                        <t t-if="u.doc_impor_export">
                                                            <t t-if="u.currency_id == u.company_id.currency_id">
                                                                <t t-set="total" t-if="u.move_type == 'in_invoice'" t-value="total + (sum(u.mapped('amount_total')) * u.manual_currency_exchange_rate)"/>
                                                                <t t-set="total" t-if="u.move_type == 'in_refund'" t-value="total - (sum(u.mapped('amount_total')) * u.manual_currency_exchange_rate)"/>
                                                                
                                                                <!-- Calculamos el Exento -->
                                                                <t t-if="u.move_type == 'in_invoice'">
                                                                    <t t-set="exento" t-value="(sum(u.invoice_line_ids.filtered(lambda line: not len(line.tax_ids)).mapped('price_subtotal')) + sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.amount == 0))).mapped('price_subtotal')))* u.manual_currency_exchange_rate"/> 
    
                                                                </t>
                                                                <t t-if="u.move_type == 'in_refund'">
                                                                    <t t-set="exento" t-value="(sum(u.invoice_line_ids.filtered(lambda line: not len(line.tax_ids)).mapped('price_subtotal')) + sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.amount == 0))).mapped('price_subtotal')))* u.manual_currency_exchange_rate"/> 
    
                                                                </t>
                                                                <!-- Calculamos los impuestos REDUCIDOS -->
                                                                <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))))">
                                                                    <!-- Base imponible del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R313" t-value="R313 + (sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R313" t-value="R313 - (sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                    <!-- Monto del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R323" t-value="R323 + ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*u.manual_currency_exchange_rate)"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R323" t-value="R323 - ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*u.manual_currency_exchange_rate)"/>
                                                                    <!-- Iva Percibido  -->
                                                                    <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                    <t t-if="u.wh_id">
                                                                        <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="retencion_r" t-value="retencion_r-(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention)*u.manual_currency_exchange_rate)"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="retencion_r" t-value="retencion_r+(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention)*u.manual_currency_exchange_rate)"/>
                                                                        <!-- Iva Percibido  -->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_r" t-value="iva_percibido_r-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention))*u.manual_currency_exchange_rate)"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_r" t-value="iva_percibido_r+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention))*u.manual_currency_exchange_rate)"/>
                                                                    </t>
                                                                </t>
                                                                <!-- Calculamos los impuestos ADICIONAL -->
                                                                <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))))">
                                                                    <!-- Base imponible del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R312" t-value="R312 +(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R312" t-value="R312 -(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                    <!-- Monto del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R322" t-value="R322 + ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*u.manual_currency_exchange_rate)"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R322" t-value="R322 - ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*u.manual_currency_exchange_rate)"/>
                                                                    <!-- Iva Percibido  -->
                                                                    <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                    <t t-if="u.wh_id">
                                                                        <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="retencion_ga" t-value="retencion_ga-(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention)*u.manual_currency_exchange_rate)"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="retencion_ga" t-value="retencion_ga+(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention)*u.manual_currency_exchange_rate)"/>
                                                                        <!-- Iva Percibido  -->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_ga" t-value="iva_percibido_ga-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention))*u.manual_currency_exchange_rate)"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_ga" t-value="iva_percibido_ga+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention))*u.manual_currency_exchange_rate)"/>
                                                                    </t>
                                                                </t>
                                                                <!-- Calculamos los impuestos GENERAL -->
                                                                <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))))">
                                                                    <!-- Base imponible del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R31" t-value="R31 +(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R31" t-value="R31 -(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                    <!-- Monto del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R32" t-value="R32 + ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*u.manual_currency_exchange_rate)"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R32" t-value="R32 - ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*u.manual_currency_exchange_rate)"/>
                                                                    <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                    <t t-if="u.wh_id">
                                                                        <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="retencion_g" t-value="retencion_g-(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention)*u.manual_currency_exchange_rate)"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="retencion_g" t-value="retencion_g+(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention)*u.manual_currency_exchange_rate)"/>
                                                                        <!-- Iva Percibido  -->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_g" t-value="iva_percibido_g-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention))*u.manual_currency_exchange_rate)"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_g" t-value="iva_percibido_g+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention))*u.manual_currency_exchange_rate)"/>
                                                                    </t>
                                                                </t>
                                                                <!-- Calculamos el TOTAL de impuestos EXENTOS -->
                                                                <t t-set="untaxed" t-if="u.move_type == 'in_invoice'" t-value="untaxed + exento"/>
                                                                <t t-set="untaxed" t-if="u.move_type == 'in_refund'" t-value="untaxed - exento"/>
                                                                <t t-set="R30" t-if="u.move_type == 'in_invoice'" t-value="R30 + exento"/>
                                                                <t t-set="R30" t-if="u.move_type == 'in_refund'" t-value="R30 - exento"/>
                                                                <!-- Retenciones -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="retencion" t-value="retencion + (u.wh_id.total_tax_ret*u.manual_currency_exchange_rate)"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="retencion" t-value="retencion - (u.wh_id.total_tax_ret*u.manual_currency_exchange_rate)"/>
                                                                <!-- TOTAL de IMPUESTOS (Reducido + General + Adicional)-->
                                                                <t t-set="tax" t-if="u.move_type == 'in_invoice'" t-value="tax + u.amount_tax"/>
                                                                <t t-set="tax" t-if="u.move_type == 'in_refund'" t-value="tax - u.amount_tax"/>
                                                                <!-- IVA PERCIBIDO -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido" t-value="iva_percibido+(((u.amount_tax)-(u.wh_id.total_tax_ret))*u.manual_currency_exchange_rate)"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido" t-value="iva_percibido-(((u.amount_tax)-(u.wh_id.total_tax_ret))*u.manual_currency_exchange_rate)"/>
                                                            </t>
                                                            <t t-else="">
                                                                <t t-set="total" t-if="u.move_type == 'in_invoice'" t-value="total + (sum(u.mapped('amount_total')))"/>
                                                                <t t-set="total" t-if="u.move_type == 'in_refund'" t-value="total - (sum(u.mapped('amount_total')))"/>
                                                                <!-- Calculamos el Exento -->
                                                                <t t-if="u.move_type == 'in_invoice'">
                                                                    <t t-set="exento" t-value="sum(u.invoice_line_ids.filtered(lambda line: not len(line.tax_ids)).mapped('price_subtotal')) + sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.amount == 0))).mapped('price_subtotal'))"/> 
    
                                                                </t>
                                                                <t t-if="u.move_type == 'in_refund'">
                                                                    <t t-set="exento" t-value="sum(u.invoice_line_ids.filtered(lambda line: not len(line.tax_ids)).mapped('price_subtotal')) - sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.amount == 0))).mapped('price_subtotal'))"/> 
    
                                                                </t>
                                                                <!-- Calculamos los impuestos REDUCIDOS -->
                                                                <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))))">
                                                                    <!-- Base imponible del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R313" t-value="R313 + (sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R313" t-value="R313 - (sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))"/>
                                                                    <!-- Monto del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R323" t-value="R323 + ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))))"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R323" t-value="R323 - ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))))"/>
                                                                    <!-- Iva Percibido  -->
                                                                    <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                    <t t-if="u.wh_id">
                                                                        <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="retencion_r" t-value="retencion_r-(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention))"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="retencion_r" t-value="retencion_r+(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention))"/>
                                                                        <!-- Iva Percibido  -->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_r" t-value="iva_percibido_r-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention)))"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_r" t-value="iva_percibido_r+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention)))"/>
                                                                    </t>
                                                                </t>
                                                                <!-- Calculamos los impuestos ADICIONAL -->
                                                                <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))))">
                                                                    <!-- Base imponible del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R332" t-value="R332 +(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R332" t-value="R332 -(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))"/>
                                                                    <!-- Monto del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R342" t-value="R342 + ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))))"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R342" t-value="R342 - ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))))"/>
                                                                    <!-- Iva Percibido  -->
                                                                    <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                    <t t-if="u.wh_id">
                                                                        <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="retencion_ga" t-value="retencion_ga-(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention))"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="retencion_ga" t-value="retencion_ga+(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention))"/>
                                                                        <!-- Iva Percibido  -->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_ga" t-value="iva_percibido_ga-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention)))"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_ga" t-value="iva_percibido_ga+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention)))"/>
                                                                    </t>
                                                                </t>
                                                                <!-- Calculamos los impuestos GENERAL -->
                                                                <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))))">
                                                                    <!-- Base imponible del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R33" t-value="R33 +(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R33" t-value="R33 -(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))"/>
                                                                    <!-- Monto del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R34" t-value="R34 + ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))))"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R34" t-value="R34 - ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))))"/>
                                                                    <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                    <t t-if="u.wh_id">
                                                                        <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="retencion_g" t-value="retencion_g-(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention))"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="retencion_g" t-value="retencion_g+(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention))"/>
                                                                        <!-- Iva Percibido  -->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_g" t-value="iva_percibido_g-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention)))"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_g" t-value="iva_percibido_g+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention)))"/>
                                                                    </t>
                                                                </t>
                                                                <!-- Calculamos el TOTAL de impuestos EXENTOS -->
                                                                <t t-set="untaxed" t-if="u.move_type == 'in_invoice'" t-value="untaxed + exento"/>
                                                                <t t-set="untaxed" t-if="u.move_type == 'in_refund'" t-value="untaxed - exento"/>
                                                                <t t-set="R30" t-if="u.move_type == 'in_invoice'" t-value="R30 + exento"/>
                                                                <t t-set="R30" t-if="u.move_type == 'in_refund'" t-value="R30 - exento"/>
                                                                <!-- Retenciones -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="retencion" t-value="retencion + (u.wh_id.total_tax_ret / u.manual_currency_exchange_rate)"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="retencion" t-value="retencion - (u.wh_id.total_tax_ret / u.manual_currency_exchange_rate)"/>
                                                                <!-- TOTAL de IMPUESTOS (Reducido + General + Adicional)-->
                                                                <t t-set="tax" t-if="u.move_type == 'in_invoice'" t-value="tax + u.amount_tax"/>
                                                                <t t-set="tax" t-if="u.move_type == 'in_refund'" t-value="tax - u.amount_tax"/>
                                                                <!-- IVA PERCIBIDO -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido" t-value="iva_percibido+(((u.amount_tax)-(u.wh_id.total_tax_ret)))"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido" t-value="iva_percibido-(((u.amount_tax)-(u.wh_id.total_tax_ret)))"/>
                                                            </t>
                                                            <!-- TERMINAN LOS CALCULOS -->
                                                        </t>
    
                                                        <t t-else="">
                                                                <!-- EMPIEZAN LOS CALCULOS -->
                                                            <t t-if="u.currency_id == u.company_id.currency_id">
                                                                <t t-set="total" t-if="u.move_type == 'in_invoice'" t-value="total + (sum(u.mapped('amount_total')) * u.manual_currency_exchange_rate)"/>
                                                                <t t-set="total" t-if="u.move_type == 'in_refund'" t-value="total - (sum(u.mapped('amount_total')) * u.manual_currency_exchange_rate)"/>
                                                            
                                                                <!-- Calculamos el Exento -->
                                                                <t t-if="u.move_type == 'in_invoice'">
                                                                    <t t-set="exento" t-value="(sum(u.invoice_line_ids.filtered(lambda line: not len(line.tax_ids)).mapped('price_subtotal')) + sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.amount == 0))).mapped('price_subtotal')))* u.manual_currency_exchange_rate"/> 
    
                                                                </t>
                                                                <t t-if="u.move_type == 'in_refund'">
                                                                    <t t-set="exento" t-value="(sum(u.invoice_line_ids.filtered(lambda line: not len(line.tax_ids)).mapped('price_subtotal')) + sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.amount == 0))).mapped('price_subtotal')))* u.manual_currency_exchange_rate"/> 
    
                                                                </t>
                                                                
                                                                <!-- Calculamos los impuestos REDUCIDOS -->
                                                                <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))))">
                                                                    <!-- Base imponible del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R333" t-value="R333 + (sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R333" t-value="R333 - (sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                    <!-- Monto del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R343" t-value="R343 + ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*u.manual_currency_exchange_rate)"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R343" t-value="R343 - ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*u.manual_currency_exchange_rate)"/>
                                                                    <!-- Iva Percibido  -->
                                                                    <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                    <t t-if="u.wh_id">
                                                                        <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="retencion_r" t-value="retencion_r-(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention)*u.manual_currency_exchange_rate)"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="retencion_r" t-value="retencion_r+(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention)*u.manual_currency_exchange_rate)"/>
                                                                        <!-- Iva Percibido  -->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_r" t-value="iva_percibido_r-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention))*u.manual_currency_exchange_rate)"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_r" t-value="iva_percibido_r+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention))*u.manual_currency_exchange_rate)"/>
                                                                    </t>
                                                                </t>
                                                                <!-- Calculamos los impuestos ADICIONAL -->
                                                                <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))))">
                                                                    <!-- Base imponible del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R332" t-value="R332 +(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R332" t-value="R332 -(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                    <!-- Monto del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R342" t-value="R342 + ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*u.manual_currency_exchange_rate)"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R342" t-value="R342 - ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*u.manual_currency_exchange_rate)"/>
                                                                    <!-- Iva Percibido  -->
                                                                    <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                    <t t-if="u.wh_id">
                                                                        <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="retencion_ga" t-value="retencion_ga-(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention)*u.manual_currency_exchange_rate)"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="retencion_ga" t-value="retencion_ga+(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention)*u.manual_currency_exchange_rate)"/>
                                                                        <!-- Iva Percibido  -->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_ga" t-value="iva_percibido_ga-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention))*u.manual_currency_exchange_rate)"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_ga" t-value="iva_percibido_ga+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention))*u.manual_currency_exchange_rate)"/>
                                                                    </t>
                                                                </t>
                                                                <!-- Calculamos los impuestos GENERAL -->
                                                                <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))))">
                                                                    <!-- Base imponible del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R33" t-value="R33 +(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R33" t-value="R33 -(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                    <!-- Monto del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R34" t-value="R34 + ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*u.manual_currency_exchange_rate)"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R34" t-value="R34 - ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*u.manual_currency_exchange_rate)"/>
                                                                    <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                    <t t-if="u.wh_id">
                                                                        <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="retencion_g" t-value="retencion_g-(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention)*u.manual_currency_exchange_rate)"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="retencion_g" t-value="retencion_g+(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention)*u.manual_currency_exchange_rate)"/>
                                                                        <!-- Iva Percibido  -->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_g" t-value="iva_percibido_g-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention))*u.manual_currency_exchange_rate)"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_g" t-value="iva_percibido_g+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention))*u.manual_currency_exchange_rate)"/>
                                                                    </t>
                                                                </t>
                                                                <!-- Calculamos el TOTAL de impuestos EXENTOS -->
                                                                <t t-set="untaxed" t-if="u.move_type == 'in_invoice'" t-value="untaxed + exento"/>
                                                                <t t-set="untaxed" t-if="u.move_type == 'in_refund'" t-value="untaxed - exento"/>
                                                                <t t-set="R30" t-if="u.move_type == 'in_invoice'" t-value="R30 + exento"/>
                                                                <t t-set="R30" t-if="u.move_type == 'in_refund'" t-value="R30 - exento"/>
                                                                <!-- Retenciones -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="retencion" t-value="retencion + (u.wh_id.total_tax_ret*u.manual_currency_exchange_rate)"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="retencion" t-value="retencion - (u.wh_id.total_tax_ret*u.manual_currency_exchange_rate)"/>
                                                                <!-- TOTAL de IMPUESTOS (Reducido + General + Adicional)-->
                                                                <t t-set="tax" t-if="u.move_type == 'in_invoice'" t-value="tax + u.amount_tax"/>
                                                                <t t-set="tax" t-if="u.move_type == 'in_refund'" t-value="tax - u.amount_tax"/>
                                                                <!-- IVA PERCIBIDO -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido" t-value="iva_percibido+(((u.amount_tax)-(u.wh_id.total_tax_ret))*u.manual_currency_exchange_rate)"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido" t-value="iva_percibido-(((u.amount_tax)-(u.wh_id.total_tax_ret))*u.manual_currency_exchange_rate)"/>
                                                            </t>
                                                            <t t-else="">
                                                                <t t-set="total" t-if="u.move_type == 'in_invoice'" t-value="total + (sum(u.mapped('amount_total')))"/>
                                                                <t t-set="total" t-if="u.move_type == 'in_refund'" t-value="total - (sum(u.mapped('amount_total')))"/>
                                                                <!-- Calculamos el Exento -->
                                                                <t t-if="u.move_type == 'in_invoice'">
                                                                    <t t-set="exento" t-value="sum(u.invoice_line_ids.filtered(lambda line: not len(line.tax_ids)).mapped('price_subtotal')) + sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.amount == 0))).mapped('price_subtotal'))"/> 
    
                                                                </t>
                                                                <t t-if="u.move_type == 'in_refund'">
                                                                    <t t-set="exento" t-value="sum(u.invoice_line_ids.filtered(lambda line: not len(line.tax_ids)).mapped('price_subtotal')) - sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.amount == 0))).mapped('price_subtotal'))"/> 
    
                                                                </t>
                                                                <!-- Calculamos los impuestos REDUCIDOS -->
                                                                <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))))">
                                                                    <!-- Base imponible del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R333" t-value="R333 + (sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R333" t-value="R333 - (sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))"/>
                                                                    <!-- Monto del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R343" t-value="R343 + ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))))"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R343" t-value="R343 - ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))))"/>
                                                                    <!-- Iva Percibido  -->
                                                                    <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                    <t t-if="u.wh_id">
                                                                        <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="retencion_r" t-value="retencion_r-(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention))"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="retencion_r" t-value="retencion_r+(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention))"/>
                                                                        <!-- Iva Percibido  -->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_r" t-value="iva_percibido_r-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention)))"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_r" t-value="iva_percibido_r+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'reduced'))).mapped('price_subtotal')))*retention)))"/>
                                                                    </t>
                                                                </t>
                                                                <!-- Calculamos los impuestos ADICIONAL -->
                                                                <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))))">
                                                                    <!-- Base imponible del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R332" t-value="R332 +(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R332" t-value="R332 -(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))"/>
                                                                    <!-- Monto del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R342" t-value="R342 + ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))))"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R342" t-value="R342 - ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))))"/>
                                                                    <!-- Iva Percibido  -->
                                                                    <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                    <t t-if="u.wh_id">
                                                                        <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="retencion_ga" t-value="retencion_ga-(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention))"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="retencion_ga" t-value="retencion_ga+(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention))"/>
                                                                        <!-- Iva Percibido  -->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_ga" t-value="iva_percibido_ga-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention)))"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_ga" t-value="iva_percibido_ga+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'additional'))).mapped('price_subtotal')))*retention)))"/>
                                                                    </t>
                                                                </t>
                                                                <!-- Calculamos los impuestos GENERAL -->
                                                                <t t-if="len(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))))">
                                                                    <!-- Base imponible del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R33" t-value="R33 +(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R33" t-value="R33 -(sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))"/>
                                                                    <!-- Monto del Impuesto -->
                                                                    <t t-if="u.move_type == 'in_invoice'" t-set="R34" t-value="R34 + ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))))"/>
                                                                    <t t-if="u.move_type == 'in_refund'" t-set="R34" t-value="R34 - ((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))))"/>
                                                                    <!-- Iva Percibido - IVA RETENIDO POR EL COMPRADOR -->
                                                                    <t t-if="u.wh_id">
                                                                        <!-- IVA RETENIDO POR EL COMPRADOR-->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="retencion_g" t-value="retencion_g-(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention))"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="retencion_g" t-value="retencion_g+(((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention))"/>
                                                                        <!-- Iva Percibido  -->
                                                                        <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido_g" t-value="iva_percibido_g-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention)))"/>
                                                                        <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido_g" t-value="iva_percibido_g+((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal'))-((sum(u.line_ids.filtered(lambda line: len(line.mapped('tax_line_id').filtered(lambda tax: tax.aliquot_type == 'general'))).mapped('price_subtotal')))*retention)))"/>
                                                                    </t>
                                                                </t>
                                                                <!-- Calculamos el TOTAL de impuestos EXENTOS -->
                                                                <t t-set="untaxed" t-if="u.move_type == 'in_invoice'" t-value="untaxed + exento"/>
                                                                <t t-set="untaxed" t-if="u.move_type == 'in_refund'" t-value="untaxed - exento"/>
                                                                <t t-set="R30" t-if="u.move_type == 'in_invoice'" t-value="R30 + exento"/>
                                                                <t t-set="R30" t-if="u.move_type == 'in_refund'" t-value="R30 - exento"/>
                                                                <!-- Retenciones -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="retencion" t-value="retencion + (u.wh_id.total_tax_ret / u.manual_currency_exchange_rate)"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="retencion" t-value="retencion - (u.wh_id.total_tax_ret / u.manual_currency_exchange_rate)"/>
                                                                <!-- TOTAL de IMPUESTOS (Reducido + General + Adicional)-->
                                                                <t t-set="tax" t-if="u.move_type == 'in_invoice'" t-value="tax + u.amount_tax"/>
                                                                <t t-set="tax" t-if="u.move_type == 'in_refund'" t-value="tax - u.amount_tax"/>
                                                                <!-- IVA PERCIBIDO -->
                                                                <t t-if="u.move_type == 'in_invoice'" t-set="iva_percibido" t-value="iva_percibido+(((u.amount_tax)-(u.wh_id.total_tax_ret)))"/>
                                                                <t t-if="u.move_type == 'in_refund'" t-set="iva_percibido" t-value="iva_percibido-(((u.amount_tax)-(u.wh_id.total_tax_ret)))"/>
                                                            </t>
                                                            <!-- TERMINAN LOS CALCULOS -->
                                                        </t>
    
                                                        <td><t t-esc="count"/></td> <!-- N° Operación -->
                                                        <td><span t-esc="u.invoice_date" t-options="{&quot;widget&quot;: &quot;date&quot;}"/></td> <!-- Fecha de la Factura -->
                                                        <td width="5%"><span t-esc="u.partner_id.rif"/></td>  <!-- RIF -->
                                                        <td class="text-left"><span t-esc="u.partner_id.name"/></td> <!-- Nombre o Razón social -->
                                                        <!--<td>-</td> Serie  -->
                                                        <td><span t-esc="u.partner_id.residence_type"/></td> <!-- Tipo de Proveedor -->
                                                        <td><span t-esc="u.vendor_invoice_number if u.move_type == 'in_invoice' and not u.debit_origin_id else '-'"/></td> <!-- Número de Factura -->
    
                                                        <td><span t-esc="u.nro_control"/></td> <!-- Número de Control de Factura -->
                                                        <td><span t-esc="u.num_export"/></td>  <!-- Número de Planilla de Importación -->
                                                        <td><span t-esc="u.num_import"/></td>  <!-- Número de Expediente Importación -->
                                                        <td><span t-esc="u.vendor_invoice_number if u.move_type == 'in_invoice' and u.debit_origin_id else '-'"/></td> <!-- Número Nota de Débito-->
    
                                                        <td><span t-esc="u.vendor_invoice_number if u.move_type == 'in_refund' else '-'"/></td><!-- Número Nota de Crédito -->
                                                        
                                                        <t t-if="u.move_type == 'in_refund'">
                                                            <td><span t-esc="u.reversed_entry_id.vendor_invoice_number"/></td>
                                                        </t>
                                                        <t t-elif="u.move_type == 'in_invoice' and u.debit_origin_id">
                                                            <td><span t-esc="u.debit_origin_id.vendor_invoice_number"/></td>
                                                        </t>
                                                        <t t-else="">
                                                            <td><span>-</span></td>
                                                        </t>
    
                                                        <t t-if="u.currency_id == u.company_id.currency_id">
                                                            <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span t-esc="(sum(u.mapped('amount_total'))*u.manual_currency_exchange_rate)" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td> 
                                                            <!-- Total Compras Incluyendo el IVA -->
                                                            <t t-set="monto_impuesto" t-value="(sum(u.invoice_line_ids.mapped('tax_ids.amount'))*u.manual_currency_exchange_rate)"/>
                                                            <t t-set="monto_impuesto_untaxed" t-value="(sum(u.invoice_line_ids.filtered(lambda whl: not whl.tax_ids).mapped('price_subtotal')) + sum(u.invoice_line_ids.filtered(lambda line: len(line.mapped('tax_ids').filtered(lambda tax: tax.amount == 0))).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                            <t t-set="monto_impuesto_untaxed_exento" t-value="(sum(u.invoice_line_ids.filtered(lambda whl: len(whl.tax_ids) == 0).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                            
                                                            <t t-if="exento &gt; 0">
                                                                <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t>
                                                                    <span t-esc="exento" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/>
                                                                    <t t-set="acum_exento" t-value="acum_exento + (exento)"/>
                                                                </td> 
                                                            </t>
                                                            <t t-else="">
                                                                <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span>0.0</span></td> 
                                                            </t>
                                                            <td>-</td><!-- exoneradas -->
                                                            <td>-</td><!-- no sujetas -->
                                                            <!-- IVA NO DEDUCIBLE -->
                                                            <t t-if="not u.deductible">
                                                                <t t-set="tax_deductible" t-if="u.move_type == 'in_invoice'" t-value="tax_deductible + (u.amount_tax*u.manual_currency_exchange_rate)"/>
                                                                <t t-set="tax_deductible" t-if="u.move_type == 'in_refund'" t-value="tax_deductible - (u.amount_tax*u.manual_currency_exchange_rate)"/>
                                                                <t t-set="untaxed_deductible" t-if="u.move_type == 'in_invoice'" t-value="untaxed_deductible + (sum(u.invoice_line_ids.filtered(lambda whl: whl.tax_ids).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                <t t-set="untaxed_deductible" t-if="u.move_type == 'in_refund'" t-value="untaxed_deductible - (sum(u.invoice_line_ids.filtered(lambda whl: whl.tax_ids).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                                                                                                                
                                                                <t t-if="sum(u.invoice_line_ids.mapped('tax_ids.amount')) &gt; 0">
    
                                                                <!-- <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span t-esc="(sum(u.mapped('amount_untaxed')) - exento) *u.manual_currency_exchange_rate" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td> -->
                                                                <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span t-esc="(sum(u.mapped('amount_untaxed'))*u.manual_currency_exchange_rate) - exento" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                                                </t>
                                                                <t t-else="">
                                                                    <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span>0.0</span></td>
                                                                </t>
                                                                <td><span t-esc="sum(u.invoice_line_ids.mapped('tax_ids.amount'))"/>%</td><!-- Porcentaje Alicuota -->
                                                                <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span t-esc="(u.amount_tax*u.manual_currency_exchange_rate)" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                                                <td>-</td>
                                                                <td>-</td>
                                                                <td>-</td>
                                                            <!-- Monto Impuesto -->
                                                            </t>
                                                            
                                                            <!-- IVA NO DEDUCIBLE -->
    
                                                            <!-- IVA  Retenido al VENDEDOR -->
    
                                                            <!-- Compras Exentas -->
                                                            <t t-if="u.deductible">
                                                                <t t-set="tax_not_deductible" t-if="u.move_type == 'in_invoice'" t-value="tax_not_deductible + (u.amount_tax*u.manual_currency_exchange_rate)"/>
                                                                <t t-set="tax_not_deductible" t-if="u.move_type == 'in_refund'" t-value="tax_not_deductible - (u.amount_tax*u.manual_currency_exchange_rate)"/>
                                                                <t t-set="untaxed_not_deductible" t-if="u.move_type == 'in_invoice'" t-value="untaxed_not_deductible + (sum(u.invoice_line_ids.filtered(lambda whl: whl.tax_ids).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                <t t-set="untaxed_not_deductible" t-if="u.move_type == 'in_refund'" t-value="untaxed_not_deductible - (sum(u.invoice_line_ids.filtered(lambda whl: whl.tax_ids).mapped('price_subtotal'))*u.manual_currency_exchange_rate)"/>
                                                                <td>-</td>
                                                                <td>-</td>
                                                                <td>-</td>
                                                                <td class="text-right">
                                                                    
                                                                    <t t-if="u.move_type == 'in_refund'">-</t>
                                                                    <span t-esc="(sum(u.invoice_line_ids.filtered(lambda whl: whl.tax_ids).mapped('price_subtotal'))*u.manual_currency_exchange_rate)" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/>
                                                                    
                                                                </td>
    
                                                                <td><span t-esc="sum(u.invoice_line_ids.mapped('tax_ids.amount'))"/>%</td><!-- Porcentaje Alicuota -->
    
                                                                <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span t-esc="u.amount_tax*u.manual_currency_exchange_rate" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                                            </t>
                                                            <!-- Monto Impuesto -->
                                                        </t>
                                                        <t t-else="">
                                                            <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span t-esc="(sum(u.mapped('amount_total')))" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td> 
                                                            <!-- Total Compras Incluyendo el IVA -->|
                                                            <t t-set="monto_impuesto" t-value="(sum(u.invoice_line_ids.mapped('tax_ids.amount')))"/>
                                                            <t t-set="monto_impuesto_untaxed" t-value="(sum(u.invoice_line_ids.filtered(lambda whl: not whl.tax_ids).mapped('price_subtotal')))"/>
                                                            <t t-set="monto_impuesto_untaxed_exento" t-value="(sum(u.invoice_line_ids.filtered(lambda whl: len(whl.tax_ids) == 0).mapped('price_subtotal')))"/>
                                                            <t t-if="exento &gt; 0 ">
                                                                <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t>
                                                                    <span t-esc="exento" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/>
                                                                    <t t-set="acum_exento" t-value="acum_exento + (exento)"/>
                                                                </td> 
                                                            </t>
                                                            <t t-else="">
                                                                <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span>0.0</span></td> 
                                                            </t>
                                                            <td>-</td><!-- exoneradas -->
                                                            <td>-</td><!-- no sujetas -->
                                                            <!-- IVA NO DEDUCIBLE -->
                                                            <t t-if="not u.deductible">
                                                                <t t-set="tax_deductible" t-if="u.move_type == 'in_invoice'" t-value="tax_deductible + (u.amount_tax)"/>
                                                                <t t-set="tax_deductible" t-if="u.move_type == 'in_refund'" t-value="tax_deductible - (u.amount_tax)"/>
                                                                <t t-set="untaxed_deductible" t-if="u.move_type == 'in_invoice'" t-value="untaxed_deductible + (sum(u.invoice_line_ids.filtered(lambda whl: whl.tax_ids).mapped('price_subtotal')))"/>
                                                                <t t-set="untaxed_deductible" t-if="u.move_type == 'in_refund'" t-value="untaxed_deductible - (sum(u.invoice_line_ids.filtered(lambda whl: whl.tax_ids).mapped('price_subtotal')))"/>
                                                                <t t-if="sum(u.invoice_line_ids.mapped('tax_ids.amount')) &gt; 0">
                                                                <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span t-esc="((sum(u.mapped('amount_total')) - (exento + u.amount_tax)))" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                                                </t>
                                                                <t t-else="">
                                                                    <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span>0.0</span></td>
                                                                </t>
                                                                <td><span t-esc="sum(u.invoice_line_ids.mapped('tax_ids.amount'))"/>%</td><!-- Porcentaje Alicuota -->
                                                                <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span t-esc="(u.amount_tax)" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                                                <td>-</td>
                                                                <td>-</td>
                                                                <td>-</td>
                                                            <!-- Monto Impuesto -->
                                                            </t>
                                                            <!-- IVA NO DEDUCIBLE -->
    
                                                            <!-- IVA  Retenido al VENDEDOR -->
    
                                                            <!-- Compras Exentas -->
                                                            <t t-if="u.deductible">
                                                                <t t-set="tax_not_deductible" t-if="u.move_type == 'in_invoice'" t-value="tax_not_deductible + (u.amount_tax)"/>
                                                                <t t-set="tax_not_deductible" t-if="u.move_type == 'in_refund'" t-value="tax_not_deductible - (u.amount_tax)"/>
                                                                <t t-set="untaxed_not_deductible" t-if="u.move_type == 'in_invoice'" t-value="untaxed_not_deductible + (sum(u.invoice_line_ids.filtered(lambda whl: whl.tax_ids).mapped('price_subtotal')))"/>
                                                                <t t-set="untaxed_not_deductible" t-if="u.move_type == 'in_refund'" t-value="untaxed_not_deductible - (sum(u.invoice_line_ids.filtered(lambda whl: whl.tax_ids).mapped('price_subtotal')))"/>
                                                                <td>-</td>
                                                                <td>-</td>
                                                                <td>-</td>
                                                                <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span t-esc="(sum(u.invoice_line_ids.filtered(lambda whl: whl.tax_ids).mapped('price_subtotal')))" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
    
                                                                <td><span t-esc="sum(u.invoice_line_ids.mapped('tax_ids.amount'))"/>%</td><!-- Porcentaje Alicuota -->
    
                                                                <td class="text-right"><t t-if="u.move_type == 'in_refund'">-</t><span t-esc="u.amount_tax" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                                            </t>
                                                            <!-- Monto Impuesto -->
                                                        </t>
                                                        <td>
                                                            <t t-if="u.wh_id">
                                                                <span t-esc="u.wh_id.total_tax_ret" t-options="{'widget': 'monetary', 'display_currency': u.currency_id, 'from_currency': u.currency_id}"/>
                                                            </t>                                                
                                                        </td>
                                                        <!-- IVA  Retenido al VENDEDOR -->
    
                                                        <td>
                                                            <t t-if="u.wh_id">
                                                                <span t-esc="u.wh_id.number"/>
                                                            </t>
                                                        </td><!-- Numero comprobante retencion -->

                                                        <td>
                                                            <t t-if="u.wh_id">
                                                                <span t-esc="u.wh_id.date.strftime('%d/%m/%Y')"/>
                                                            </t>
                                                        </td><!-- Fecha comprobante retencion -->
                                                    </tr>
                                                </t>
                                            </t>
                                        </tr>
                                        <tr class="total" style="font-size:10px;">
                                            <td colspan="12" class="text-right">TOTAL</td>
                                            <th class="text-right"><span t-esc="total" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th>
                                            <th class="text-right"><span t-esc="acum_exento" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th>
                                            <th/>
                                            <th/>
                                            
                                            <!-- DEDUCIBLE INICIO -->
                                            <th class="text-right"><span t-esc="R33 + R31 + R312 + R313 + R332 + R333" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th><!--BASE IMPONIBLE -->
                                            <td/>
                                            <th class="text-right"><span t-esc="tax_deductible" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th>
                                            <!-- DEDUCIBLE FIN -->
                                            <t t-set="R30" t-value="acum_exento"/>
                                            <!-- NO DEDUCIBLE INICIO -->
                                            <th class="text-center"><span t-esc="untaxed_not_deductible" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th>
                                            <td/>
                                            <th class="text-center"><span t-esc="tax_not_deductible" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th>
                                            <!-- MO DEDUCIBLE FIN -->
    
                                            <!-- <t t-set="R34" t-value="tax"/> -->
                                            <!-- <th><span t-esc="acumret" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th> -->
                                            <th class="text-center"><span t-esc="retencion" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th>
                                            <th>-</th>
                                        </tr>
                                    </tbody>
                                </t>
                            </t>
                            <t t-else="">
                                <tbody>
                                    <tr>
                                        <td colspan="23">
                                            <span>Sin actividad en el periodo solicitado</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </t>
                            <!--    Se definen las variables dependientes de otras-->
                            <t t-set="R34" t-value="R34-R342-R343"/>
                            <t t-set="R33" t-value="R33-R332-R333"/>  
                            <t t-set="R342" t-value="R342-R322"/>
                            <t t-set="R343" t-value="R343-R323"/>
                            <t t-set="R35" t-value="R30+R332+R333+R33+R312+R313"/>
                            <t t-set="R36" t-value="R34+R342+R343+R32+R322+R323"/>
                        </table>
                        <br/>
                        <!-- <div class="col-xs-4 table-responsive-sm" align="right"> 
                            <table class="table-condensed tableizer-tableT" style="font-size:10px;">-->
                            <table class="text-left;" style="width:60%;font-size:10px;margin-left:15%;">
                                <thead style="display: table-row-group">
                                    <tr>
                                        <th/>
                                        <th/>
                                        <th class="align-middle">Base imponible</th>
                                        <th/>
                                        <th class="align-middle">Crédito fiscal</th>
                                        <th style="width:2%"/>
                                        <th class="align-middle">IVA Retenido<br/>(al Vendedor)</th>
                                        <th style="width:2%"/>
                                        <th class="align-middle">IVA Retenido<br/>(a Terceros)</th>
                                        <th/>
                                        <th class="align-middle" style="width:8%;"><small style="font-size:7px;padding:0px;">para ser declarado y pagado como Retenciones</small><br/>Anticipo IVA</th>
                                    </tr>
                                </thead>
                                <t t-if="con_documento">
                                    <tbody>
                                        <t t-set="ducs" t-value="docs.filtered(lambda doc: doc.wh_lines.invoice_id.transaction_type != '04-ajuste')"/>
                                        <!-- TOTAL DE EXPEDINTES -->
                                        <!-- <tr>
                                            <td style="border:1px solid #000;padding:3px;" class="text-left">Total de Facturas con Espediente</td>
                                            <td style="border:1px solid #000;padding:3px;"><strong><div style="border:1px solid black;">?</div></strong></td>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;"><span t-esc="total_expe" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"></span></td>
                                            <td style="border:1px solid #000;"/>
                                            <td/>
                                            <th style="border:1px solid #000;"/>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
                                        </tr> -->
                                        <tr>
                                            <td style="border:1px solid #000;padding:3px;" class="text-left">Total: Compras Exentas y/o sin derecho a crédito fiscal</td>
                                            <td style="border:1px solid #000;padding:3px;"><strong><div style="border:1px solid black;">30</div></strong></td>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-if="R30" t-esc="acum_exento" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/><t t-else="">0,00</t></td>
                                            <td style="border:1px solid #000;"/>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;">0,00</td>
                                            <td/>
                                            <th style="border:1px solid #000;"/>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
                                        </tr>
                                        <tr>
                                            <td style="border:1px solid #000;padding:3px;" class="text-left">Suma de las: Compras Importación Afectas solo Alicuota General</td>
                                            <td style="border:1px solid #000;padding:3px;"><strong><div style="border:1px solid black;">31</div></strong></td>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-if="R31" t-esc="R31" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/><t t-else="">0,00</t></td>
                                            <td style="border:1px solid #000;padding:3px;"><strong><div style="border:1px solid black;">32</div></strong></td>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-if="R32" t-esc="R32" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/><t t-else="">0,00</t></td>
                                            <td/>
                                            <th style="border:1px solid #000;"/>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
                                        </tr>
                                        <tr>
                                            <td style="border:1px solid #000;padding:3px;" class="text-left">Suma de las: Compras Importación Afectas solo Alicuota General + Adicional</td>
                                            <td style="border:1px solid #000;padding:3px;"><strong><div style="border:1px solid black;">312</div></strong></td>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-if="R312" t-esc="R312" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/><t t-else="">0,00</t></td>
                                            <td style="border:1px solid #000;padding:3px;"><strong><div style="border:1px solid black;">322</div></strong></td>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-if="R322" t-esc="R322" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/><t t-else="">0,00</t></td>
                                            <td/>
                                            <th style="border:1px solid #000;"/>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
                                        </tr>
                                        <tr>
                                            <td style="border:1px solid #000;padding:3px;" class="text-left">Suma de las: Compras Importación Afectas en Alicuota Reducida</td>
                                            <td style="border:1px solid #000;padding:3px;"><strong><div style="border:1px solid black;">313</div></strong></td>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-if="R313" t-esc="R313" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/><t t-else="">0,00</t></td>
                                            <td style="border:1px solid #000;padding:3px;"><strong><div style="border:1px solid black;">323</div></strong></td>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-if="R323" t-esc="R323" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/><t t-else="">0,00</t></td>
                                            <td/>
                                            <th style="border:1px solid #000;"/>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
                                        </tr>
                                        <tr>
                                            <td style="border:1px solid #000;padding:3px;" class="text-left">Suma de las: Compras Internas Afectas solo Alicuota General</td>
                                            <td style="border:1px solid #000;padding:3px"><strong><div style="border:1px solid black;">33</div></strong></td>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-if="R33" t-esc="R33" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/><t t-else="">0,00</t></td>
                                            <td style="border:1px solid #000;padding:3px"><strong><div style="border:1px solid black;">34</div></strong></td>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-esc="R34" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                            <td/>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-esc="retencion" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
                                        </tr>
                                        <tr>
                                            <td style="border:1px solid #000;padding:3px;" class="text-left">Suma de las: Compras Internas Afectas en Alicuota General + Adicional</td>
                                            <td style="border:1px solid #000;padding:3px;"><strong><div style="border:1px solid black;">332</div></strong></td>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-if="R332" t-esc="R332" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/><t t-else="">0,00</t></td>
                                            <td style="border:1px solid #000;padding:3px;"><strong><div style="border:1px solid black;">342</div></strong></td>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-if="R342" t-esc="R342" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/><t t-else="">0,00</t></td>
                                            <td/>
                                            <th style="border:1px solid #000;"/>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
                                        </tr>
                                        <tr>
                                            <td style="border:1px solid #000;padding:3px;" class="text-left">Suma de las: Compras Internas Afectas en Alicuota Reducida</td>
                                            <td style="border:1px solid #000;padding:3px;"><strong><div style="border:1px solid black;">333</div></strong></td>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-if="R333" t-esc="R333" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/><t t-else="">0,00</t></td>
                                            <td style="border:1px solid #000;padding:3px;"><strong><div style="border:1px solid black;">343</div></strong></td>
                                            <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-if="R343" t-esc="R343" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/><t t-else="">0,00</t></td>
                                            <td/>
                                            <th style="border:1px solid #000;"/>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
                                            <th/>
                                            <th style="border:1px solid #000;"/>
    
                                        </tr>
    
                                        <tr class="total">
                                            <th><strong>Total</strong></th>
                                            <th style="padding:3px;"><strong><div style="border:1px solid black;">35</div></strong></th>
                                            <th class="text-right" style="padding-right:5px;"><t t-esc="R30+R31+R312+R313+R33+R332+R333" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th>
                                            <th style="padding:3px;"><strong><div style="border:1px solid black;">36</div></strong></th>
                                            <th class="text-right" style="padding-right:5px;"><t t-esc="R34+R342+R343+R32+R322+R323" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th>
                                            <th/>
                                            <th class="text-right" style="padding-right:5px;"><t t-esc="retencion" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></th>
                                            <th/>
                                            <th/>
                                            <th style="padding:3px;"><strong><div style="border:1px solid black;">65</div></strong></th>
                                            <th/>
                                        </tr>
                                    </tbody>
                                </t>
                                <t t-else="">
                                    <tbody>
                                        <tr>
                                            <td colspan="23">
                                                <span>Sin actividad en el periodo solicitado</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </t>
                            </table>
                        <!-- </div> -->
                        <br/>
                         <!-- <div class="col-xs-4" align="right">
                            <table class="table-condensed tableizer-tableT" style="font-size:10px;"> -->
                            <table class="text-left;" style="width:20%;font-size:10px;margin-left:35%;">
                                <thead style="display: table-row-group">
                                    <tr>
                                        <th colspan="3">Resumen Tasa General</th>
                                    </tr>
                                    <tr>
    
                                        <th style="border:1px solid #000;">Tasa</th>
                                        <th style="border:1px solid #000;">Base Imponible </th>
                                        <th style="border:1px solid #000;">Debito Fiscal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="border:1px solid #000;">8%</td>
                                        <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-esc="R313 + R333" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                        <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-esc="R343 + R323" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                    </tr>
                                    <tr>
                                        <td style="border:1px solid #000;">16%</td>
                                        <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-esc="R33 + R31" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                        <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-esc="R34 + R32" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                    </tr>
                                    <tr>
                                        <td style="border:1px solid #000;">22%</td>
                                        <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-esc="R312 + R332" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                        <td class="text-right" style="border:1px solid #000;padding-right:5px;"><t t-esc="R322 + R342" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></td>
                                    </tr>
                                    <tr class="total">
                                        <th/>
                                        <th class="text-right" style="padding-right:5px;"><strong><t t-esc="R313 + R333 + R33 + R31 + R312 + R332" t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></strong></th>
                                        <th class="text-right" style="padding-right:5px;"><strong><t t-esc="R343 + R323 + R34 + R32 + R322 + R342 " t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></strong></th>
                                    </tr>
                                    
                                </tbody>
                            </table>
                        <!-- </div> -->
                        <br/>
                    </div>
                </t>
    
                <div t-attf-class="footer o_boxed_footer o_company_#{company_id.id}_layout">
                    <div class="text-center">
                        <ul class="list-inline">
                       
                        </ul>
                        <div t-field="company_id.report_footer"/>
                        <div t-if="report_type == 'pdf'">
                            Página: <span class="page"/> / <span class="topage"/>
                        </div>
                    </div>
                </div>
            </t>   
            <!-- <t t-debug="pdb"/> -->
        </xpath>   
        <!-- <t t-debug="pdb"/> -->
    </template>
</odoo>
